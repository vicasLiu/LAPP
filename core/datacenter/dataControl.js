var localData = {
	nearShop : [{
		lng : "113.94886083263248",
		lat : "22.540624261539335"
	},{
		lng : "113.94661850589603",
		lat : "22.537572182354854"
	},{
		lng : "113.95033068317264",
		lat : "22.53938560117423"
	},{
		lng : "113.95010537761539",
		lat : "22.538146929695543"
	}],
	shopList : [{
    	id : "1", name : "日兴堂药房", address : "深南科技立交桥深南大道科技路", vtime : "2014-04-11 15：24", IMG : "ic_con_pharmacy_01l.png"
    },{
    	id : "2", name : "仁和堂药房", address : "深圳市南山区科技南四路", vtime : "2014-04-11 14：34", IMG : "ic_con_pharmacy_02l.png"
    },{
    	id : "3", name : "海王星晨", address : "南山区高新南一道深南大道科技路", vtime : "2014-04-11 13：44", IMG : "ic_con_pharmacy_02l.png"
    },{
    	id : "4", name : "宝华药房", address : "深圳市南山区科技南路55号", vtime : "2014-04-11 12：34", IMG : "ic_con_pharmacy_01l.png"
    }],
    visitPath : [{
    	id : "1", name : "日兴堂药房", address : "深南科技立交桥深南大道科技路", inTime : "2014-04-11 09:45", outTime : "2014-04-11 09:45", attachId : "aid1"
    },{
    	id : "2", name : "仁和堂药房", address : "深圳市南山区科技南四路", inTime : "2014-04-11 09:45", outTime : "2014-04-11 09:45", attachId : "aid2"
    },{
    	id : "3", name : "海王星晨", address : "深圳市南山区深南科技立交桥高新南一道深南大道科技路", inTime : "2014-04-11 09:45", outTime : "2014-04-11 09:45", attachId : "aid3"
    },{
    	id : "4", name : "宝华药房", address : "深圳市南山区科技南路55号", inTime : "2014-04-11 09:45", outTime : "2014-04-11 09:45", attachId : "aid4"
    }],
    attachData : {
    	id1 : [{
    		filePath : "",
			fileData : "",
			fileName : "",
			type : "image/pjpeg"
    	},{
    		filePath : "",
			fileData : "",
			fileName : "",
			type : "image/pjpeg"
    	},{
    		filePath : "",
			fileData : "",
			fileName : "",
			type : "image/pjpeg"
    	},{
    		filePath : "",
			fileData : "",
			fileName : "",
			type : "image/pjpeg"
    	},{
    		filePath : "",
			fileData : "",
			fileName : "",
			type : "image/pjpeg"
    	}],
    	id2 : [],
    	id3 : [],
    	id4 : []
    },
    attach : {
    	aid1 : {
    		text : "销售状况良好",
    		ach : "id1"
    	},
    	aid2 : {
    		text : "销售状况良好",
    		ach : "id2"
    	},
    	aid3 : {
    		text : "销售状况良好",
    		ach : "id3"
    	},
    	aid4 : {
    		text : "销售状况良好",
    		ach : "id4"
    	}
    },
	shopInfo : [{
		id : "1",
        IMG : "ic_con_pharmacy_03l.png",
        shop_name : "日兴堂药房",
		address : "深南科技立交桥深南大道科技路",
		type : "加盟",
		area : "1000平米",
		turnover : "500万",
		format : "专卖店",
		shopCrewData : [{
	        crew_name: '罗珊珊',
	        position: '店长',
	        date: '1988-09-09',
	        num: '13423413357'
	    },
	    {
            crew_name: '陈顺峰',
	        position: '店员',
	        date: '1988-09-09',
	        num: '13423413357'
	    }]
	},{
		id : "2",
        IMG : "ic_con_pharmacy_01l.png",
        shop_name : "仁和堂药房",
		address : "深圳市南山区科技南四路",
		type : "加盟",
		area : "100平米",
		turnover : "500万",
		format : "零售店",
		shopCrewData : [{
            crew_name: '罗珊珊',
	        position: '店长',
	        date: '1988-09-09',
	        num: '13423413357'
	    },
	    {
            crew_name: '陈顺峰',
	        position: '店员',
	        date: '1988-09-09',
	        num: '13423413357'
	    }]
	},{
		id : "3",
        IMG : "ic_con_pharmacy_01l.png",
        shop_name : "海王星晨",
		address : "南山区深南科技立交桥高新南一道深南大道科技路",
		type : "连锁",
		area : "500平米",
		turnover : "500万",
		format : "专卖店",
		shopCrewData : [{
	        crew_name: '罗珊珊',
	        position: '店长',
	        date: '1988-09-09',
	        num: '13423413357'
	    },
	    {
            crew_name: '陈顺峰',
	        position: '店员',
	        date: '1988-09-09',
	        num: '13423413357'
	    }]
	},{
		id : "4",
        IMG : "ic_con_pharmacy_02l.png",
        shop_name : "宝华药房",
		address : "深圳市南山区科技南路55号",
		type : "加盟",
		area : "1000平米",
		turnover : "500万",
		format : "专卖店",
		shopCrewData : [{
            crew_name: '罗珊珊',
	        position: '店长',
	        date: '1988-09-09',
	        num: '13423413357'
	    },
	    {
            crew_name: '陈顺峰',
	        position: '店员',
	        date: '1988-09-09',
	        num: '13423413357'
	    }]
	}],
	shopCrewData : [{
        crew_name: '罗珊珊',
        position: '店长',
        date: '1988-09-09',
        num: '13423413357'
	},{
        crew_name: '陈顺峰',
        position: '店员',
        date: '1988-09-09',
        num: '13423413357'
	}],
	record : [{
    	date : "2014-04-11",
    	list : [{
    		time : "09:14",
    		address : "海王星晨"
    	},{
    		time : "19:14",
    		address : "仁和堂药房"
    	}]
    },{
    	date : "2014-04-10",
    	list : [{
    		time : "09:14",
    		address : "宝华药房"
    	},{
    		time : "19:14",
    		address : "日兴堂药房"
    	}]
    },{
    	date : "2014-04-09",
    	list : [{
    		time : "09:14",
    		address : "日兴堂药房"
    	},{
    		time : "19:14",
    		address : "仁和堂药房"
    	}]
    },{
    	date : "2014-04-08",
    	list : [{
    		time : "09:14",
    		address : "海王星晨"
    	},{
    		time : "19:14",
    		address : "仁和堂药房"
    	}]
    },{
    	date : "2014-04-07",
    	list : [{
    		time : "09:14",
    		address : "日兴堂药房"
    	},{
    		time : "19:14",
    		address : "海王星晨"
    	}]
    },{
    	date : "2014-04-06",
    	list : [{
    		time : "09:14",
    		address : "日兴堂药房"
    	},{
    		time : "19:14",
    		address : "仁和堂药房"
    	}]
    }],
	visitDetail : []
};
var DataControl = function( page ) {
	if( page.getLocalData("localData") == null ) {
		page.setLocalData("localData", localData);
	}
	var data = page.getLocalData("localData");
	var addRecord = function( arg ) {
		var cb = arg["cb"];
		var recordData = arg["data"];
		var id = recordData["id"];
		var attData = recordData["attachObj"];
		var aData = null;
		for( var i = 0; i < data.visitPath.length; i++ ) {
			if(data.visitPath[i].id == id) {
				var aid = data.visitPath[i].attachId;
				if( attData.type == "text" ) {
					data.attach[aid].text = attData.text;
				}else{
					var _aData = data.attach[aid].ach;
					aData = data.attachData[_aData];
					aData.push(attData);
				}
			}
		}
//		data.record.push(recordData);
		page.setLocalData("localData", data);
		cb({
			status : "success"
		});
	};
	var addShop = function( arg ) {
		var cb = arg["cb"];
		var d = arg["data"]["shopObj"];
		var obj = d["form"];
		var crewObj = d["crewObj"];
		obj["shopCrewData"] = crewObj;
		data.shopInfo.push(obj);
		data.shopList.push({
			id : obj.id,
			name : obj.name,
			address : obj.address,
			vtime : ""
		});
		page.setLocalData("localData", data);
		cb({
			status : "success"
		});
	};
	var addVisitDetail = function( arg ) {
		var cb = arg["cb"];
		var d = arg["data"];
		var obj = d['obj'];
		var id = d["id"];
		var visitPath = data.visitPath;
		for( var i = 0; i < visitPath.length; i++ ) {
			if( id == visitPath[i].id ) {
				visitPath[i].inTime = obj.sTime;
				visitPath[i].outTime = obj.eTime;
			}
		}
		page.setLocalData("localData", data);
		cb({
			status : "success"
		});
	};
	var getRecord = function( arg ) {
		var cb = arg["cb"];
		cb({
			record : data.record,
			status : "success"
		});
	};
	var getShopList = function( arg ) {
		var cb = arg["cb"];
		cb({
			listdata : data.shopList,
			status : "success"
		});
	};
	var getShopCrewData = function( arg ) {
		var cb = arg["cb"];
		cb({
			listdata : data.shopCrewData,
			status : "success"
		});
	};
	var getPath = function( arg ) {
		var cb = arg["cb"];
		cb({
			listdata : data.visitPath,
			status : "success"
		});
	};
	var getDetail = function( arg ) {
		var cb = arg['cb'];
		var dData = arg['data'];
		var id = dData['id'];
		var visitPath = data.visitPath;
		var detailData = [];
		var attachRtData = [];
		for( var i = 0; i < visitPath.length; i++ ) {
			if( id == visitPath[i].id ) {
				var attachID = visitPath[i].attachId;
				var attachData = data.attach[attachID];
				var note = attachData["text"];
				detailData.push({
					id : id,
					address : visitPath[i].address,
					signInTime : visitPath[i].inTime,
					signOutTime : visitPath[i].outTime,
					note : note
				});
				attachRtData = attachData["ach"];
			}
		}
		cb({
			detail : detailData,
			attach : attachRtData,
			status : "success"
		});
	};
	var getShopInfo = function( arg ) {
		var cb = arg['cb'];
		var d = arg["data"];
		var id = d["id"];
		var infos = data.shopInfo;
		var info = null;
		for ( var i = 0; i < infos.length; i++ ) {
			if( infos[i].id == id ) {
				info = infos[i];
			}
		}
		cb({
			listdata : [info],
			status : "success"
		});
	};
	var addCrew = function( arg ) {
		var cb = arg['cb'];
		var d = arg['data'];
		var crewData = d["crewObj"];
		data.shopCrewData.push(crewData);
		cb({
			status:"success"
		});
		page.setLocalData("localData", data);
	};
	var getCrewInfo = function( arg ) {
		var cb = arg['cb'];
		var d = arg['data'];
		var id = d["id"];
		var crewData = data.shopCrewData;
		var retData = [];
		for( var i = 0; i < crewData.length; i++ ) {
			if( crewData[i].name == id ) {
				retData.push(crewData[i]);
				break;
			}
		}
		cb({
			detail : retData,
			status:"success"
		});
	};
	this.handleData = function( arg ) {
		var dataFun = arg["data"]["dataFun"];
		switch( dataFun ) {
			case "getRecord":
				getRecord(arg);
				break;
			case "getShopList":
				getShopList(arg);
				break;
			case "getShopCrewData":
				getShopCrewData(arg);
				break;
			case "getPath":
				getPath(arg);
				break;
			case "getDetail":
				getDetail(arg);
				break;
			case "getShopInfo":
				getShopInfo(arg);
				break;
			case "getCrewInfo":
				getCrewInfo(arg);
				break;
			case "addRecord":
				addRecord(arg);
				break;
			case "addShop":
				addShop(arg);
				break;
			case "addVisitDetail":
				addVisitDetail(arg);
				break;
			case "addCrew":
				addCrew(arg);
				break;
		}
	};
};
